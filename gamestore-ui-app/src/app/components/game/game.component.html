<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Loading game details...</p>
</div>

<!-- Error State -->
<div *ngIf="error" class="error-container">
  <p class="error-message">{{ error }}</p>
</div>


<!-- Game Product Page -->
<div *ngIf="!loading && !error && game" class="product-page">
  <div class="product-container">
    <!-- Left Side - Image Gallery -->
    <div class="product-gallery">
      <div class="main-product-image">
        <img 
          [src]="getRandomGameImage(game.id)" 
          [alt]="game.name + ' cover'"
          class="product-main-image">
        <div class="play-button">‚ñ∂</div>
      </div>
      
      <div class="gallery-thumbnails">
        <div 
          *ngFor="let thumb of [1,2,3,4]; let i = index" 
          class="gallery-thumb"
          [class.active]="i === selectedImageIndex"
          (click)="selectImage(i)">
          <img 
            [src]="getRandomGameImage(game.id + i)" 
            [alt]="'Screenshot ' + (i + 1)"
            class="thumb-image">
          <div class="play-overlay" *ngIf="i === 0">‚ñ∂</div>
        </div>
      </div>
    </div>

    <!-- Right Side - Product Information -->
    <div class="product-info">
      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span>Home</span> > <span>Games</span> > <span>{{ game?.name || 'Loading...' }}</span>
      </div>

      <!-- Game Title -->
      <h1 class="product-title">{{ game?.name || 'Loading...' }}</h1>
      <div class="product-subtitle">Launch Edition</div>

      <!-- Rating -->
      <div class="product-rating">
        <div class="stars">{{ getStars(game?.rating || 4.5) }}</div>
        <span class="rating-number">{{ game?.rating || 4.5 }}</span>
        <span class="reviews-count">{{ game?.reviewCount || 142 }} Reviews</span>
      </div>

      <!-- Price -->
      <div class="product-price">
        <span class="current-price">${{ getDiscountedPrice().toFixed(2) }}</span>
        <span class="original-price" *ngIf="game?.discount && game?.discount > 0">${{ game?.price?.toFixed(2) || '59.99' }}</span>
        <div class="discount-info" *ngIf="game?.discount && game?.discount > 0">
          <span class="discount-percentage">-{{ game.discount }}% OFF</span>
          <span class="savings-amount">Save ${{ (game.price * game.discount / 100).toFixed(2) }}</span>
        </div>
      </div>

      <!-- Quick Info -->
      <div class="product-quick-info">
        <div class="info-row">
          <span class="info-label">{{ 'gameDetail.platformsOn' | translate }}</span>
          <span class="info-value">PC only</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ 'gameDetail.genre' | translate }}</span>
          <span class="info-value">{{ game?.genre || ('common.loading' | translate) }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">{{ 'gameDetail.publisher' | translate }}</span>
          <span class="info-value">{{ game?.publisher || ('common.loading' | translate) }}</span>
        </div>
      </div>

      <!-- Platform Tags -->
      <div class="platform-tags">
        <span class="platform-tag">{{ 'gameDetail.platforms.windows' | translate }}</span>
        <span class="platform-tag">{{ 'gameDetail.platforms.steam' | translate }}</span>
        <span class="platform-tag">{{ 'gameDetail.platforms.singlePlayer' | translate }}</span>
        <span class="platform-tag">{{ 'gameDetail.platforms.controller' | translate }}</span>
      </div>

      <!-- Add to Cart Button -->
      <button class="add-to-cart-button" (click)="addToCart()">
        {{ 'gameDetail.addToCart' | translate }}
      </button>
      <!-- Game Description -->
      <div class="game-description">
        <h3>Game Description</h3>
        <p>{{ game?.description || ('common.loading' | translate) }}</p>
        
      </div>
    </div>
  </div>
</div>

<!-- Comments Section -->
<div class="comments-section" *ngIf="!loading && !error && game">
  <div class="comments-container">
    <div class="comments-header">
      <h2>{{ comments.length || 162 }} Comments</h2>
      <button class="write-comment-btn" (click)="toggleCommentForm()">
        {{ showCommentForm ? 'Cancel' : 'Write a comment' }}
      </button>
    </div>

    <!-- Comment Form -->
    <div class="comment-form-container" *ngIf="showCommentForm">
      <div class="comment-form">
        <div class="form-header">
          <h3>Write a Review</h3>
          <div class="rating-input">
            <span>Your Rating:</span>
            <div class="star-rating">
              <span 
                *ngFor="let star of [1,2,3,4,5]" 
                class="star-input" 
                [class.active]="star <= newCommentRating"
                (click)="setRating(star)"
                (mouseover)="hoverRating = star"
                (mouseleave)="hoverRating = 0">
                {{ star <= (hoverRating || newCommentRating) ? '‚òÖ' : '‚òÜ' }}
              </span>
            </div>
          </div>
        </div>
        
        <div class="form-fields">
          <input 
            type="text" 
            placeholder="Your Name" 
            [(ngModel)]="newCommentUsername"
            class="username-input">
          
          <textarea 
            placeholder="Write your review here..." 
            [(ngModel)]="newCommentContent"
            class="comment-textarea"
            rows="4"></textarea>
          
          <div class="form-actions">
            <button class="submit-comment-btn" (click)="submitComment()">
              Submit Review
            </button>
            <button class="cancel-comment-btn" (click)="cancelComment()">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="comments-list">
      <div *ngFor="let comment of comments; let i = index" class="comment-item">
        <div class="comment-header">
          <div class="comment-user">
            <div class="user-avatar">{{ comment.username?.charAt(0).toUpperCase() || 'U' }}</div>
            <div class="user-details">
              <div class="username">{{ comment.username || 'Anonymous User' }}</div>
              <div class="user-rating">
                <div class="stars">{{ getStars(comment.rating || 5) }}</div>
                <span class="rating-value">{{ comment.rating || 5 }}</span>
              </div>
            </div>
          </div>
          <div class="comment-date">{{ formatDate(comment.date) }}</div>
        </div>
        
        <div class="comment-content">
          <p>{{ comment.content || 'This game is amazing! The graphics are incredible and the gameplay is so smooth. Highly recommend to anyone who loves action games.' }}</p>
        </div>
        
        <div class="comment-actions">
          <button 
            class="like-button" 
            [class.liked]="isCommentLiked(comment.id)"
            [class.animated]="animatingLike === comment.id"
            (click)="likeComment(comment.id)">
            <span class="like-icon">{{ isCommentLiked(comment.id) ? '‚ù§Ô∏è' : 'ü§ç' }}</span>
            <span class="like-text">{{ isCommentLiked(comment.id) ? 'Liked' : 'Like' }}</span>
            <span class="like-count">({{ getLikeCount(comment.id) }})</span>
          </button>
          <button class="reply-button">Reply</button>
          <button class="report-button">Report</button>
        </div>
      </div>
    </div>

    <div class="load-more-comments" *ngIf="comments.length >= 5">
      <button class="load-more-button" (click)="loadMoreComments()">
        Load More Comments
      </button>
    </div>
  </div>
</div>