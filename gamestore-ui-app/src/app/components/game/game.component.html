<!-- Loading State -->
<div *ngIf="loading" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Loading game details...</p>
</div>

<!-- Error State -->
<div *ngIf="error" class="error-container">
  <p class="error-message">{{ error }}</p>
</div>

<!-- Debug Info -->
<div style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 10px; font-size: 12px; z-index: 9999;">
  <div>Loading: {{ loading }}</div>
  <div>Error: {{ error }}</div>
  <div>Game: {{ game ? 'Loaded' : 'Not loaded' }}</div>
  <div>Game ID: {{ gameId }}</div>
</div>

<!-- Game Product Page -->
<div *ngIf="!loading && !error && game" class="product-page">
  <div class="product-container">
    <!-- Left Side - Image Gallery -->
    <div class="product-gallery">
      <div class="main-product-image">
        <img 
          [src]="getRandomGameImage(game.id)" 
          [alt]="game.name + ' cover'"
          class="product-main-image">
        <div class="play-button">‚ñ∂</div>
      </div>
      
      <div class="gallery-thumbnails">
        <div 
          *ngFor="let thumb of [1,2,3,4]; let i = index" 
          class="gallery-thumb"
          [class.active]="i === selectedImageIndex"
          (click)="selectImage(i)">
          <img 
            [src]="getRandomGameImage(game.id + i)" 
            [alt]="'Screenshot ' + (i + 1)"
            class="thumb-image">
          <div class="play-overlay" *ngIf="i === 0">‚ñ∂</div>
        </div>
      </div>
    </div>

    <!-- Right Side - Product Information -->
    <div class="product-info">
      <!-- Breadcrumb -->
      <div class="breadcrumb">
        <span>Home</span> > <span>Games</span> > <span>{{ game?.name || 'Game Details' }}</span>
      </div>

      <!-- Game Title -->
      <h1 class="product-title">{{ game?.name || 'Ace Combat 7: Skies Unknown' }}</h1>
      <div class="product-subtitle">Launch Edition</div>

      <!-- Rating -->
      <div class="product-rating">
        <div class="stars">{{ getStars(game?.rating || 4.5) }}</div>
        <span class="rating-number">{{ game?.rating || 4.5 }}</span>
        <span class="reviews-count">{{ game?.reviewCount || 142 }} Reviews</span>
      </div>

      <!-- Price -->
      <div class="product-price">
        <span class="current-price">${{ getDiscountedPrice().toFixed(2) }}</span>
        <span class="original-price" *ngIf="game?.discount && game?.discount > 0">${{ game?.price?.toFixed(2) || '59.99' }}</span>
        <div class="discount-info" *ngIf="game?.discount && game?.discount > 0">
          <span class="discount-percentage">-{{ game.discount }}% OFF</span>
          <span class="savings-amount">Save ${{ (game.price * game.discount / 100).toFixed(2) }}</span>
        </div>
      </div>

      <!-- Quick Info -->
      <div class="product-quick-info">
        <div class="info-row">
          <span class="info-label">Platforms on:</span>
          <span class="info-value">PC only</span>
        </div>
        <div class="info-row">
          <span class="info-label">Genre:</span>
          <span class="info-value">{{ game?.genre || 'Action, Adventure' }}</span>
        </div>
        <div class="info-row">
          <span class="info-label">Publisher:</span>
          <span class="info-value">{{ game?.publisher || 'BANDAI NAMCO Entertainment America Inc' }}</span>
        </div>
      </div>

      <!-- Platform Tags -->
      <div class="platform-tags">
        <span class="platform-tag">Windows</span>
        <span class="platform-tag">Steam</span>
        <span class="platform-tag">Single-player</span>
        <span class="platform-tag">Controller</span>
      </div>

      <!-- Add to Cart Button -->
      <button class="add-to-cart-button" (click)="addToCart()">
        Add to Cart
      </button>

      <!-- What You Get Section -->
      <div class="what-you-get">
        <h3>What You Get</h3>
        <ul class="features-list">
          <li>‚úì Purchase and use without a monthly subscription.</li>
          <li>‚úì Get early gaming access.</li>
          <li>‚úì No ads in games.</li>
          <li>‚úì Access to 1,000+ games.</li>
          <li>‚úì PlayStation full Favorites Access.</li>
          <li>‚úì Special monthly free games like God of War, Days 2.</li>
          <li>‚úì EA SPORTS FC 24, including up to 4,600 FC Points (a $40 Value), plus</li>
          <li>‚úì Madden NFL 24 Superstar Edition and FIFA 23 Ultimate Team with</li>
          <li>‚úì Ultimate Team cards and other bonus content when you're an EA Play</li>
          <li>‚úì 10% discount in the PlayStation store and unlock big game's.</li>
        </ul>
      </div>

      <!-- Game Description -->
      <div class="game-description">
        <h3>Game Description</h3>
        <p>{{ game?.description || 'Become an ace pilot and soar through photorealistic skies with full 360 degree movement; down enemy aircraft and experience the thrill of engaging in realistic sorties! Aerial combat has never looked or felt better!' }}</p>
        
        <p>This intensive adventure, which also aims to exceed the series the rest of engaging in realistic sorties! With realistic controls and gameplay, you can truly feel the intensity of the battle as you soar across photorealistic environments that respond to real-time weather conditions.</p>
        
        <p>The intuitive controls, which are designed around both single-player and real-person action with your teammates, serve to make the experience of piloting aircraft clear and straightforward from the movement inputs.</p>
        
        <p>You'll love classic airplane that looks and flies so real, as from the moment you accelerate down the runway to the time you land back at home base, with a vast range of different aircraft types to fly and fight with.</p>
        
        <p>You'll be getting your hands on various new aircraft, all new customization features, all of which let's you take the new real life and intense feeling aircraft.</p>
      </div>
    </div>
  </div>
</div>

<!-- Comments Section -->
<div class="comments-section" *ngIf="!loading && !error && game">
  <div class="comments-container">
    <div class="comments-header">
      <h2>{{ comments.length || 162 }} Comments</h2>
      <button class="write-comment-btn" (click)="toggleCommentForm()">
        {{ showCommentForm ? 'Cancel' : 'Write a comment' }}
      </button>
    </div>

    <!-- Comment Form -->
    <div class="comment-form-container" *ngIf="showCommentForm">
      <div class="comment-form">
        <div class="form-header">
          <h3>Write a Review</h3>
          <div class="rating-input">
            <span>Your Rating:</span>
            <div class="star-rating">
              <span 
                *ngFor="let star of [1,2,3,4,5]" 
                class="star-input" 
                [class.active]="star <= newCommentRating"
                (click)="setRating(star)"
                (mouseover)="hoverRating = star"
                (mouseleave)="hoverRating = 0">
                {{ star <= (hoverRating || newCommentRating) ? '‚òÖ' : '‚òÜ' }}
              </span>
            </div>
          </div>
        </div>
        
        <div class="form-fields">
          <input 
            type="text" 
            placeholder="Your Name" 
            [(ngModel)]="newCommentUsername"
            class="username-input">
          
          <textarea 
            placeholder="Write your review here..." 
            [(ngModel)]="newCommentContent"
            class="comment-textarea"
            rows="4"></textarea>
          
          <div class="form-actions">
            <button class="submit-comment-btn" (click)="submitComment()">
              Submit Review
            </button>
            <button class="cancel-comment-btn" (click)="cancelComment()">
              Cancel
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="comments-list">
      <div *ngFor="let comment of comments; let i = index" class="comment-item">
        <div class="comment-header">
          <div class="comment-user">
            <div class="user-avatar">{{ comment.username?.charAt(0).toUpperCase() || 'U' }}</div>
            <div class="user-details">
              <div class="username">{{ comment.username || 'Anonymous User' }}</div>
              <div class="user-rating">
                <div class="stars">{{ getStars(comment.rating || 5) }}</div>
                <span class="rating-value">{{ comment.rating || 5 }}</span>
              </div>
            </div>
          </div>
          <div class="comment-date">{{ formatDate(comment.date) }}</div>
        </div>
        
        <div class="comment-content">
          <p>{{ comment.content || 'This game is amazing! The graphics are incredible and the gameplay is so smooth. Highly recommend to anyone who loves action games.' }}</p>
        </div>
        
        <div class="comment-actions">
          <button 
            class="like-button" 
            [class.liked]="isCommentLiked(comment.id)"
            [class.animated]="animatingLike === comment.id"
            (click)="likeComment(comment.id)">
            <span class="like-icon">{{ isCommentLiked(comment.id) ? '‚ù§Ô∏è' : 'ü§ç' }}</span>
            <span class="like-text">{{ isCommentLiked(comment.id) ? 'Liked' : 'Like' }}</span>
            <span class="like-count">({{ getLikeCount(comment.id) }})</span>
          </button>
          <button class="reply-button">Reply</button>
          <button class="report-button">Report</button>
        </div>
      </div>
    </div>

    <div class="load-more-comments" *ngIf="comments.length >= 5">
      <button class="load-more-button" (click)="loadMoreComments()">
        Load More Comments
      </button>
    </div>
  </div>
</div>